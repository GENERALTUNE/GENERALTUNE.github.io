<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en"><head> 
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <title>获取位置信息</title></head>
  <script src="js/external.js" type="text/javascript"></script>
  <body>
    获取位置信息<div class="content-display"></div>
    百度信息：<div id="baidu_geo"></div>
    <script src="js/geolocationbaiduapi.js" type="text/javascript"></script>
    <script type="text/javascript" >
     
    function getLocation() {

      var options = {   
        enableHighAccuracy: true,
           maximumAge: 1000  
      } ;
      if (navigator.geolocation) { 
        //浏览器支持geolocation  
        navigator.geolocation.getCurrentPosition(onSuccess, onError, options); 
      } else {   
        //浏览器不支持geolocation  
        alert('您的浏览器不支持地理位置定位');  
      } 
    };
     //成功时
    function onSuccess(position) { 
      //返回用户位置  //经度 
      var contentEle =  document.getElementsByClassName('content-display')[0];
      var longitude = position.coords.longitude;  
      //纬度  
      var latitude = position.coords.latitude;  
      contentEle.innerHTML = contentEle.innerHTML + '<br>当前地址的经纬度：经度' + longitude + '，纬度' + latitude; 
      // var myScript = 
      showPosition(position);

      //根据经纬度获取地理位置，不太准确，获取城市区域还是可以的  
      var map = new BMap.Map("allmap"); 
      var point = new BMap.Point(longitude, latitude);
      var gc = new BMap.Geocoder();  
      gc.getLocation(point, function(rs) {  
        var addComp = rs.addressComponents;  
        contentEle.innerHTML = contentEle.innerHTML + '<br>' + addComp.province + ", " + addComp.city + ", " + addComp.district + ", " + addComp.street + ", " + addComp.streetNumber;  
        console.log(rs);
      });
      // 这里后面可以写你的后续操作了
      // postData(longitude, latitude);
     } 
      //失败时
      function onError(error) { 
        switch (error.code) { 
          case 1:
                alert("位置服务被拒绝");   
            break;   
          case 2:
                alert("暂时获取不到位置信息"); 
            break;  
          case 3:
                alert("获取信息超时");   
            break;   
          case 4:
                alert("未知错误");    
            break; 
        }  
        // 这里后面可以写你的后续操作了  
        //经度 
        var longitude = 23.1823780000;  
        //纬度  
        var latitude = 113.4233310000;  
        // postData(longitude, latitude);
      };

      window.onload = function() {
        // html5获取地理位置 
        getLocation();

      };

      function showPosition(position) {
        var latlon = position.coords.latitude + ',' + position.coords.longitude;

        //baidu
        
  // var url = '<a href="http://api.map.baidu.com/geocoder/v2/?ak=C93b5178d7a8ebdb830b9b557abce78b&callback=renderReverse&location=' + latlon + '&output=json&pois=0">http://api.map.baidu.com/geocoder/v2/?ak=C93b5178d7a8ebdb830b9b557abce78b&callback=renderReverse&location=' + latlon + '&output=json&pois=0</a>';
  var url = 'https://api.map.baidu.com/geocoder/v2/?ak=C93b5178d7a8ebdb830b9b557abce78b&callback=renderReverse&location=' + latlon + '&output=json&pois=0';

        $.ajax({
          type: "GET",
          dataType: "jsonp",
          url: url,
          beforeSend: function() {
            $("#baidu_geo").html('正在定位...');
          },
          success: function(json) {
            if (json.status == 0) {
              $("#baidu_geo").html(json.result.formatted_address);
              console.log(json.result.formatted_address);
            }
          },
          error: function(XMLHttpRequest, textStatus, errorThrown) {
            $("#baidu_geo").html(latlon + "地址位置获取失败");
          }
        });
      };

    </script>
  </body>
</html>
